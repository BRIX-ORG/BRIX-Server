generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum MediaType {
  IMAGE
  GLTF
  VIDEO
}

enum TagType {
  REALTIME
  ART
  PRODUCT
}

enum Role {
  USER
  ADMIN
}

enum Provider {
  LOCAL
  GOOGLE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

model User {
  id               String   @id @default(uuid()) @db.Uuid
  username         String   @unique
  fullName         String   @map("fullname")
  email            String   @unique
  phone            String?
  password         String
  gender           Gender   @default(OTHER)
  avatar           Json?     @db.JsonB
  background       Json?     @db.JsonB
  address          String?
  shortDescription String?  @map("short_description")
  trustScore       Float    @default(0) @map("trust_score")
  role             Role     @default(USER)
  provider         Provider @default(LOCAL)
  verifiedAt       DateTime? @map("verified_at")
  refreshToken     String?  @map("refresh_token")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  bricks Brick[]

  @@map("users")
}

model Brick {
  id           String    @id @default(uuid()) @db.Uuid
  userId       String    @map("user_id") @db.Uuid
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  mediaUrl     String    @map("media_url")
  thumbnailUrl String?   @map("thumbnail_url")
  watermarkUrl String?   @map("watermark_url")
  title        String
  description  String?   @db.Text
  mediaType    MediaType @map("media_type")
  tagType      TagType?  @map("tag_type")
  address      String?
  latitude     Decimal?  @db.Decimal(9, 6)
  longitude    Decimal?  @db.Decimal(9, 6)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  metadata BrickMetadata?

  @@map("bricks")
}

model BrickMetadata {
  id         String    @id @default(uuid()) @db.Uuid
  brickId    String    @unique @map("brick_id") @db.Uuid
  brick      Brick     @relation(fields: [brickId], references: [id], onDelete: Cascade)
  rawExif    Json?     @map("raw_exif")
  modelData  Json?     @map("model_data")
  hashSha256 String?   @map("hash_sha256")
  onChainTx  String?   @map("on_chain_tx")
  verifiedAt DateTime? @map("verified_at")

  @@map("brick_metadata")
}

